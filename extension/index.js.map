{"mappings":"gCAAMA,eA2DN,SAASC,EAAYC,EAAQC,EAAQC,GAGpC,GAFAF,EAAOG,IAAIC,MAAM,0BAA2BF,GAExCA,EAAS,CACZ,IAAIG,EAAgBH,EACfG,EAAcC,WAAW,OAC7BD,EAAgB,IAAMA,GAGvBL,EAAOG,IAAIC,MAAM,oBAAqBF,GAEtCD,EACEM,KAAKF,GACLG,MAAK,IAtET,SAAgBR,EAAQC,GACvB,MAAMQ,EAAgBT,EAAOU,UAAU,iBAmCvC,SAASC,EAAgBC,GACxBX,EAAOY,IAAIJ,EAAcK,MAAOF,GAnCjCZ,EAAOG,IAAIY,KAAK,gCAAgCN,EAAcK,UAE9Db,EAAOe,WAAU,CAACC,EAAMC,EAAMC,EAASC,KACtC,MACMC,EADSD,EAAKE,cACQC,KAAIC,GACb,UAAdA,EAAKC,KACD,IACHD,EACHE,YAAaF,EAAKE,YAAYC,OAAO,CACpCC,kBAAmB,UACnBC,eAAgB,OAChBC,KAAM,SAKF,IACHN,KAIDP,EAAKc,gBAAkBtB,EAAcK,MAAMiB,eAC9C/B,EAAOgC,YACN,eACA,MAACd,UAAMC,EAASc,OAAQZ,IACxBa,IACKA,GACHC,QAAQC,MAAMF,SAWnBlC,EAAOqC,UAAU,kBAAmB1B,GAEpCX,EAAOqC,UAAU,oBAAoB,KACZrC,EAAOU,UAAU,mBACrBI,QACnBd,EAAOG,IAAIY,KAAK,wBACQf,EAAOU,UAAU,mBACzBI,OAAQ,EACxBd,EAAOsC,SAAS,kBAAmB3B,GACnCV,EAAOsC,KAAK9B,EAAcK,WAIJd,EAAOU,UAAU,mBACzBI,OAAQ,EAgBV0B,CAAOxC,EAAQC,KAC1BwC,OAAMC,IACN1C,EAAOG,IAAIiC,MAAM,+BAA+BM,MACxB1C,EAAOU,UAAU,mBACzBI,OAAQ,MA+B5B6B,OAAAC,QAAiB,SAAU5C,GAC1BA,EAAOU,UAAU,gBAAiB,CACjCmC,aAAc,KAEf7C,EAAOU,UAAU,kBAAmB,CACnCmC,cAAc,IAEf7C,EAAOG,IAAIY,KAAK,oCAEhB,MAAM+B,EAAaC,EAAe/C,EAAQ,eAE1C8C,EAAWE,aAAYC,MAAMC,KArC9B,SAAyBlD,EAAQC,GAChCD,EAAOG,IAAIY,KAAK,mCAChB,MAAMN,EAAgBT,EAAOU,UAAU,iBAEnCD,EAAcK,QACjBd,EAAOG,IAAIY,KAAK,wBAAyBN,EAAcK,OACvDf,EAAYC,EAAQC,EAAQQ,EAAcK,QAG3Cd,EAAOqC,UAAU,iBAAiB,MACTrC,EAAOU,UAAU,mBACpBI,OAASL,EAAcK,QAC3Cd,EAAOG,IAAIY,KAAK,6BAA8BN,EAAcK,OAC5Df,EAAYC,EAAQC,EAAQQ,EAAcK,WAG5Cd,EAAOG,IAAIY,KAAK,wCAsBfoC,CAAgBnD,EAAQkD,MAGzBJ,EAAWM,eAAcH,SAtB1B,SAA4BjD,GAC3BA,EAAOG,IAAIY,KAAK,qCACQf,EAAOU,UAAU,mBACzBI,OAAQ,EACxBd,EAAOG,IAAIY,KAAK,0CAkBqBsC,CAAmBrD,KACxDA,EAAOG,IAAIY,KAAK","sources":["src/extension/index.js"],"sourcesContent":["const {requireService} = require('nodecg-io-core');\n\nfunction onJoin(nodecg, client) {\n\tconst twitchChannel = nodecg.Replicant('twitchChannel');\n\tnodecg.log.info(`Connected to twitch channel \"${twitchChannel.value}\"`);\n\n\tclient.onMessage((chan, user, message, _msg) => {\n\t\tconst emotes = _msg.parseEmotes();\n\t\tconst parsedEmotes = emotes.map(curr => {\n\t\t\tif (curr.type === 'emote') {\n\t\t\t\treturn {\n\t\t\t\t\t...curr,\n\t\t\t\t\tdisplayInfo: curr.displayInfo.getUrl({\n\t\t\t\t\t\tanimationSettings: 'default',\n\t\t\t\t\t\tbackgroundType: 'dark',\n\t\t\t\t\t\tsize: '1.0'\n\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t...curr\n\t\t\t};\n\t\t});\n\n\t\tif (chan.toLowerCase() === twitchChannel.value.toLowerCase()) {\n\t\t\tnodecg.sendMessage(\n\t\t\t\t'ChatReceived',\n\t\t\t\t{user, message, msgobj: parsedEmotes},\n\t\t\t\terr => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t});\n\n\tfunction sendChatMessage(msg) {\n\t\tclient.say(twitchChannel.value, msg);\n\t}\n\n\tnodecg.listenFor('SendChatMessage', sendChatMessage);\n\n\tnodecg.listenFor('DisconnectTwitch', () => {\n\t\tconst twitchConnected = nodecg.Replicant('twitchConnected');\n\t\tif (twitchConnected.value) {\n\t\t\tnodecg.log.info('Disconnecting twitch');\n\t\t\tconst twitchConnected = nodecg.Replicant('twitchConnected');\n\t\t\ttwitchConnected.value = false;\n\t\t\tnodecg.unlisten('SendChatMessage', sendChatMessage);\n\t\t\tclient.part(twitchChannel.value);\n\t\t}\n\t});\n\n\tconst twitchConnected = nodecg.Replicant('twitchConnected');\n\ttwitchConnected.value = true;\n}\n\nfunction joinChannel(nodecg, client, channel) {\n\tnodecg.log.debug('actually doing join to ', channel);\n\n\tif (channel) {\n\t\tlet channelToJoin = channel;\n\t\tif (!channelToJoin.startsWith('#')) {\n\t\t\tchannelToJoin = '#' + channelToJoin;\n\t\t}\n\n\t\tnodecg.log.debug('doing it for real', channel);\n\n\t\tclient\n\t\t\t.join(channelToJoin)\n\t\t\t.then(() => onJoin(nodecg, client))\n\t\t\t.catch(reason => {\n\t\t\t\tnodecg.log.error(`Couldn't connect to twitch: ${reason}.`);\n\t\t\t\tconst twitchConnected = nodecg.Replicant('twitchConnected');\n\t\t\t\ttwitchConnected.value = false;\n\t\t\t});\n\t}\n}\n\nfunction setupTwitchChat(nodecg, client) {\n\tnodecg.log.info('Setting up Twitch Chat service.');\n\tconst twitchChannel = nodecg.Replicant('twitchChannel');\n\n\tif (twitchChannel.value) {\n\t\tnodecg.log.info('Joining last channel ', twitchChannel.value);\n\t\tjoinChannel(nodecg, client, twitchChannel.value);\n\t}\n\n\tnodecg.listenFor('ConnectTwitch', () => {\n\t\tconst twitchConnected = nodecg.Replicant('twitchConnected');\n\t\tif (!twitchConnected.value && twitchChannel.value) {\n\t\t\tnodecg.log.info('Joining requested channel ', twitchChannel.value);\n\t\t\tjoinChannel(nodecg, client, twitchChannel.value);\n\t\t}\n\t});\n\tnodecg.log.info('Done setting up Twitch Chat service.');\n}\n\nfunction teardownTwitchChat(nodecg) {\n\tnodecg.log.info('Tearing down Twitch Chat service.');\n\tconst twitchConnected = nodecg.Replicant('twitchConnected');\n\ttwitchConnected.value = false;\n\tnodecg.log.info('Done tearing down Twitch Chat service.');\n}\n\nmodule.exports = function (nodecg) {\n\tnodecg.Replicant('twitchChannel', {\n\t\tdefaultValue: ''\n\t});\n\tnodecg.Replicant('twitchConnected', {\n\t\tdefaultValue: false\n\t});\n\tnodecg.log.info('Twitch listener bundle starting.');\n\n\tconst twitchChat = requireService(nodecg, 'twitch-chat');\n\n\ttwitchChat.onAvailable(async tcClient => {\n\t\tsetupTwitchChat(nodecg, tcClient);\n\t});\n\n\ttwitchChat.onUnavailable(async () => teardownTwitchChat(nodecg));\n\tnodecg.log.info('Twitch listener bundle is running.');\n};\n"],"names":["requireService","$57621f5187ddf231$var$joinChannel","nodecg","client","channel","log","debug","channelToJoin","startsWith","join","then","twitchChannel","Replicant","sendChatMessage","msg","say","value","info","onMessage","chan","user","message","_msg","parsedEmotes","parseEmotes","map","curr","type","displayInfo","getUrl","animationSettings","backgroundType","size","toLowerCase","sendMessage","msgobj","err","console","error","listenFor","unlisten","part","$57621f5187ddf231$var$onJoin","catch","reason","module","exports","defaultValue","twitchChat","$57621f5187ddf231$require$requireService","onAvailable","async","tcClient","$57621f5187ddf231$var$setupTwitchChat","onUnavailable","$57621f5187ddf231$var$teardownTwitchChat"],"version":3,"file":"index.js.map","sourceRoot":"../"}