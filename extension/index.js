var e=require("nodecg-io-core").requireService;function t(e,t,n){if(e.log.info("actually doing join to ",n),n){let i=n;i.startsWith("#")||(i="#"+i),e.log.info("doing it for real",n),t.join(i).then((()=>function(e,t){e.log.info("ok setting up");const n=e.Replicant("twitchChannel");function i(e){t.say(n.value,e)}e.log.info(`Connected to twitch channel "${n.value}"`),t.onMessage(((t,i,o,a)=>{const c=a.parseEmotes().map((e=>"emote"===e.type?{...e,displayInfo:e.displayInfo.getUrl({animationSettings:"default",backgroundType:"dark",size:"1.0"})}:{...e}));t.toLowerCase()===n.value.toLowerCase()&&e.sendMessage("ChatReceived",{user:i,message:o,msgobj:c},(e=>{e&&console.error(e)}))})),e.listenFor("SendChatMessage",i),e.listenFor("DisconnectTwitch",(()=>{e.Replicant("twitchConnected").value&&(e.log.info("Disconnecting twitch"),e.Replicant("twitchConnected").value=!1,e.unlisten("SendChatMessage",i),t.part(n.value))})),e.Replicant("twitchConnected").value=!0}(e,t))).catch((t=>{e.log.error(`Couldn't connect to twitch: ${t}.`);e.Replicant("twitchConnected").value=!1}))}}module.exports=function(n){n.Replicant("twitchChannel",{defaultValue:""}),n.Replicant("twitchConnected",{defaultValue:!1}),n.log.info("Twitch extension starting.");const i=e(n,"twitch-chat");i.onAvailable((async e=>{!function(e,n){e.log.info("Setting up Twitch Chat service.");const i=e.Replicant("twitchChannel");i.value&&(e.log.info("Read existing channel, starting wtih ",i.value),t(e,n,i.value)),e.listenFor("ConnectTwitch",(()=>{!e.Replicant("twitchConnected").value&&i.value&&(e.log.info("got connect channel, connecting to ",i.value),t(e,n,i.value))})),e.log.info("Done setting up Twitch Chat service.")}(n,e)})),i.onUnavailable((async()=>function(e){e.log.info("Tearing down Twitch Chat service."),e.Replicant("twitchConnected").value=!1,e.log.info("Done tearing down Twitch Chat service.")}(n)))};
//# sourceMappingURL=index.js.map
